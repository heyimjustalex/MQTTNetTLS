# MQTTNetTLS


## PLAN TO FIX THIS SHIT!

### EDITING PKIGenerator
1. Generate broker certificate by generating .key and .pfx/cer <br/>
    - there is problem with enrypted pem format - fix it <br/>
    - the certificate must be signed by rootCA and might need to have some flags like EXPORTABLE <br/>
    - this function: <br/>
    
     private static void ExportPrivateKeyToPemFile(RSA privateKey, string password, string filePath) <br/>
    i think does export properlu cause i am able to decrypt with openssl<br/>
    openssl rsa -in key.pem -out decrypted-key.pem<br/>

    
    

    this function might help:<br/>

          public static void ExportPrivateKeyToFile(X509Certificate2 certificate, string privateKeyFilePath, string password)
      {
          try
          {
              File.WriteAllText(privateKeyFilePath, GetPrivateKeyAsPEM(certificate, password));
              Console.WriteLine("Private key exported successfully.");
          }
          catch (Exception ex)
          {
              Console.WriteLine($"Error exporting private key: {ex.Message}");
          }
      }



### EDITING SERVER

1. public static X509Certificate2 ReadCertificateWithPrivateKey - now problm is with reading pem format (that is generated by me)<br/>
I think writing is ok, cuz as i said openssl reads generated pem just fine


This might help<br/>

       private static RSA GetPrivateKeyFromPEM(string privateKeyPem, string privateKeyPassword)<br/>
       {<br/>
           // Parse the PEM-encoded private key and return an RSA object<br/>
           var rsa = RSA.Create();<br/>

           rsa.ImportFromEncryptedPem(privateKeyPem, privateKeyPassword);<br/>
           return rsa;<br/>
       }<br/>